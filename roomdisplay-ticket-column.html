<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iris-polymer-ticketlist/iris-ticketlist.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<dom-module id="roomdisplay-ticket-column">
  <template>
    <style>
      :host {
        display: block;
      }
      
      iron-icon {
        color: white;
        background-color: var(--mydoc-brown-400);
        border-radius: 50%;
        height: 40px;
        width: 40px;
        margin-right: 10px;
      }
      
      .roomdisplay-column-head,
      .display-row {
        font-size: 32px;
      }
      
      .display-row {
        height: 70px;
      }
      
      table {
        display: inline-block;
      }
      
      th,
      td {
        padding: 0 30px;
        text-align: center;
      }
      
      td span {
        border-bottom: 2px solid var(--mydoc-red-400);
        display: inline-block;
        margin: 0 auto;
        width: 150px;
        font-size: 42px;
        flex-basis: 100px;
      }
    </style>


    <template is="dom-repeat" items="[[splitByColumns(content)]]" as="ticket_col">
      <table class="roomdisplay-column-head">
        <tr>
          <th>
            <iron-icon icon="expand-more"></iron-icon>Клиент
          </th>
          <th>
            <iron-icon icon="expand-more"></iron-icon>Окно
          </th>
        </tr>

        <template is="dom-repeat" items="[[ticket_col]]">
          <tr class="display-row">
            <td class="ticket-label"><span>[[item.label]]</span></td>
            <td class="operator-label"><span>[[item.operator.short_label]]</span></td>
          </tr>
        </template>

      </table>
    </template>

  </template>
  <script>
    'use strict'
    Polymer({
      is: 'roomdisplay-ticket-column',
      properties: {
        tickets: {
          type: Array,
          value: []
        },
        colsCount: {
          type: Number,
          value: 2,
          reflectToAttribute: true
        },
        rowsCount: {
          type: Number,
          value: 6,
          reflectToAttribute: true
        },
        content: {
          type: Array,
          computed: 'computeContent(colsCount, rowsCount,tickets)'
        }
      },
      splitByColumns(tickets) {
        return _.chunk(tickets, this.rowsCount);
      },
      computeContent(colsCount, rowsCount, tickets) {
        let total = this.colsCount * this.rowsCount;
        if (!this.tickets || this.tickets.length >= total)
          return tickets;
        let count = total - this.tickets.length;
        let empty = _.fill(Array(count), {});

        return _.concat(empty, _.reverse(this.tickets));
      },
      ready() {
        this.row_model = [{
          label: "Клиент",
          field: 'label'
        }, {
          label: 'Окно',
          field: ['destination'],
          transform: function(ticket) {
            let dest = ticket.destination;

            return dest.label;
          }
        }];
      }
    });
  </script>
</dom-module>